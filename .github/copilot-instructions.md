<!--
Guidance for AI coding agents working on the Masonry Knowledge Base
Do not add aspirational advice — document only what is discoverable in the repo.
-->
# Agent guide for ASBM_Knowledge-Base

## Start here
- Docusaurus v3 static site; all docs live under `docs/`, product pages nest under `docs/vendors/<vendor>/products/`.
- Build pipeline runs Pagefind via `scripts/build-search.js` right after `docusaurus build` to populate `build/pagefind/`.
- `docusaurus.config.js` sets `onBrokenLinks: 'throw'`, so missing/changed paths break the build.
- CI (`.github/workflows/pr-ci.yml`) pins Node 20, runs `npm run build`, then `node scripts/freshness-check.mjs`; keep local changes compatible with that flow.

## Key files to know
- `docusaurus.config.js` — site metadata, baseUrl, editUrl, broken-link behaviour.
- `sidebars.js` — mixes explicit ordering with autogenerated sections; new docs under autogenerated folders appear automatically, but move/rename files carefully.
- `src/components/PagefindSearch.jsx` — lazy-loads `/pagefind/pagefind.js` on the client; keep script path stable.
- `scripts/build-search.js` — wraps `npx pagefind --site build`; assumes Pagefind can run inside the Node environment that built the site.
- `scripts/freshness-check.mjs` — reads `last_verified` front-matter and fails when content is older than 180 days.

## Workflows & verification
- Install deps: `npm install` (or `npm ci` in CI) from repo root.
- Run the dev server: `npm start` (wraps `docusaurus start`).
- Production build: `npm run build` → runs `docusaurus build && node scripts/build-search.js`.
- Before opening a PR: run `npm run build` and `node scripts/freshness-check.mjs` locally to catch the same failures CI enforces.

## Data generation & content rules
- `scripts/csv_to_mdx.mjs` generates vendor product pages into `docs/vendors/<vendor>/products/`.
  - Input CSV headers expected: `title,vendor,sku,primary_category,secondary_categories,substrates,applications,coverage_rate,packaging,tds,sds,last_verified`.
  - Slug rule: use `sku` if present, else `title`; lowercase and replace `[^a-z0-9]+` with `-` (e.g. `My Product 100` → `my-product-100`).
  - Parser is minimal: no embedded-comma support and trims whitespace; sanitise CSVs beforehand.
- Generated MDX front-matter keys (`title`, `vendor`, `sku`, etc.) are consumed by both the freshness script and site templates; keep names stable across scripts and docs.

## Gotchas & preservation notes
- Use Node 20 locally to mirror CI; older versions may fail when running Pagefind or ES module scripts.
- `scripts/build-search.js` requires that `npm run build` completes first so `build/` exists; missing build output leads to Pagefind errors.
- When reorganising docs, update internal links and check `sidebars.js` for any manually curated sections.
- Pagefind assets deploy under `/pagefind/`; avoid moving or renaming that folder without updating the loader component.
- If freshness thresholds change, update both `scripts/freshness-check.mjs` and any documentation that describes review cadence.
