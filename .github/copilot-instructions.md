<!--
Guidance for AI coding agents working on the Masonry Knowledge Base
Do not add aspirational advice — document only what is discoverable in the repo.
-->
# Copilot instructions for ASBM_Knowledge-Base

Quick reference (what this project is)
- Static documentation site built with Docusaurus v3 (see `docusaurus.config.js`).
- Docs content lives under `docs/` and product pages appear under `docs/vendors/...`.
- Search is implemented with Pagefind; build step runs `npx pagefind --site build` (see `scripts/build-search.js`).

Essential files and where to look
- `docusaurus.config.js` — site title, baseUrl, editUrl, and important build settings (onBrokenLinks: 'throw').
- `sidebars.js` — explicit ordering for some docs and an autogenerated section for the rest.
- `src/components/PagefindSearch.jsx` — client-side integration for Pagefind search UI (loads `/pagefind/pagefind.js`).
- `scripts/csv_to_mdx.mjs` — CSV → MDX generator used for vendor product pages (important: lightweight CSV parsing; no embedded-comma support).
- `scripts/freshness-check.mjs` — detects stale pages by parsing `last_verified` front-matter.
- `scripts/build-search.js` — runs Pagefind after `docusaurus build` (wraps `npx pagefind --site build`).

Build & dev workflows (these are the discoverable commands)
- Install: run `npm install` (package.json contains Docusaurus/React/pagefind deps).
- Local dev: `npm start` -> runs `docusaurus start` (hot reload docs).
- Production build: `npm run build` -> runs `docusaurus build && node scripts/build-search.js`.
  - Note: `scripts/build-search.js` calls `npx pagefind --site build`. If Pagefind is not installed globally this will still work via npx.
- Serve built site locally: `npm run serve` -> `docusaurus serve`.
- Content checks: `node scripts/freshness-check.mjs` exits non-zero when pages contain `last_verified` older than threshold (180 days by default).

Content conventions and automation (concrete, copyable rules)
- Product MDX files are generated into `docs/vendors/<vendor>/products/` by `scripts/csv_to_mdx.mjs`.
- Expected CSV header keys used by the generator include: `title,vendor,sku,primary_category,secondary_categories,substrates,applications,coverage_rate,packaging,tds,sds,last_verified`.
- `csv_to_mdx.mjs` slug rules: uses `sku` or `title`, lowers case and replaces any `[^a-z0-9]+` with `-`. Example: `My Product 100` -> `my-product-100`.
- MDX front-matter keys visible in the repo: `title`, `vendor`, `sku`, `primary_category`, `secondary_categories`, `substrates`, `applications`, `coverage_rate`, `packaging`, `links` (tds/sds), `last_verified`.
- `last_verified` is parsed as a date string (YYYY-MM-DD). The freshness check scans `.md` and `.mdx` files for `last_verified: "YYYY-MM-DD"`.

<!--
Repository-specific Copilot guidance for ASBM_Knowledge-Base.
Document only what is discoverable in the repo (no aspirational advice).
-->

# Quick guide (core facts)

- Docusaurus v3 static site. Docs live under `docs/`. Vendor product pages are under `docs/vendors/<vendor>/products/`.
- Search uses Pagefind; site build must include Pagefind output (`scripts/build-search.js` runs `npx pagefind --site build`).

# Key files to inspect

- `docusaurus.config.js` — site settings; note `onBrokenLinks: 'throw'` (builds fail on broken links).
- `scripts/csv_to_mdx.mjs` — CSV → MDX generator (very light CSV parsing; no support for embedded commas).
- `scripts/freshness-check.mjs` — checks `last_verified` front-matter and exits non-zero for stale pages.
- `src/components/PagefindSearch.jsx` — loads `/pagefind/pagefind.js` at runtime.

# Developer workflows (commands discovered in repo)

- Install deps: `npm install`
- Dev server: `npm start` (runs `docusaurus start`)
- Build (production): `npm run build` — runs `docusaurus build && node scripts/build-search.js` (Pagefind via npx)
- Serve build: `npm run serve` (runs `docusaurus serve`)
- Freshness check: `node scripts/freshness-check.mjs` (fails if `last_verified` older than 180 days)

# Conventions & examples

- CSV → MDX: `node scripts/csv_to_mdx.mjs input.csv docs/vendors/<vendor>/products`
  - Expected CSV headers: `title,vendor,sku,primary_category,secondary_categories,substrates,applications,coverage_rate,packaging,tds,sds,last_verified`.
  - Slug rule: use `sku` or `title`, lowercase, replace `[^a-z0-9]+` with `-` (e.g. `My Product 100` -> `my-product-100`).
- Front-matter keys relied upon by scripts: `title`, `vendor`, `sku`, `primary_category`, `secondary_categories`, `substrates`, `applications`, `coverage_rate`, `packaging`, `links` (tds/sds), `last_verified`.

# Preservation notes

- Keep `onBrokenLinks: 'throw'` behaviour in mind when renaming/moving docs — update `sidebars.js` and internal links.
- If you change front-matter key names, update both `scripts/csv_to_mdx.mjs` and `scripts/freshness-check.mjs`.

If you want this expanded into CI steps (build + freshness check + Pagefind) or a PR checklist, say which format you prefer and I will add it.
