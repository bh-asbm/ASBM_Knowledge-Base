# Agents Guide: ASBM Knowledge Base

## TL;DR
- Static docs site powered by Docusaurus 3; most content under `docs/`, vendor pages under `docs/vendors/<vendor>/products/`.
- Builds must run `npm run build` (Docusaurus + Pagefind) followed by `node scripts/freshness-check.mjs`; CI enforces this on Node 18.
- Pagefind assets live in `build/pagefind/`; `scripts/build-search.js` wraps `npx pagefind --site build` and expects a fresh build output.

## Workflows to know
- Install deps: `npm install` (use `npm ci` in automation).
- Local dev: `npm start` -> launches `docusaurus start` with hot reload.
- Production build: `npm run build` -> runs `docusaurus build && node scripts/build-search.js`.
- Pre-PR checks: `npm run build` and `node scripts/freshness-check.mjs`; catches the same failures as `.github/workflows/pr-ci.yml`.

## Key files & scripts
- `docusaurus.config.js` — metadata, routing, and `onBrokenLinks: 'throw'` (any bad link breaks builds).
- `sidebars.js` — combination of manual ordering and autogenerated sections; moving docs may require sidebar updates.
- `src/components/PagefindSearch.jsx` — loads `/pagefind/pagefind.js`; keep the URL stable if you move assets.
- `scripts/build-search.js` — runs Pagefind; fails if `build/` is missing or Node < 18 lacks supported features.
- `scripts/freshness-check.mjs` — exits non-zero when `last_verified` is older than 180 days.

## Content automation
- `scripts/csv_to_mdx.mjs` converts CSV rows into MDX product pages inside `docs/vendors/<vendor>/products/`.
  - Expected headers: `title,vendor,sku,primary_category,secondary_categories,substrates,applications,coverage_rate,packaging,tds,sds,last_verified`.
  - Slug logic: prefer `sku`, fallback to `title`; lowercase, replace `[^a-z0-9]+` with `-`.
  - Parser is minimal: no embedded commas; clean CSVs beforehand.
- Generated front-matter (`title`, `vendor`, `sku`, etc.) powers freshness checks and UI components—keep field names consistent.

## Gotchas
- Match CI’s Node version (18) to avoid Pagefind/ESM issues.
- Always run Pagefind after a successful Docusaurus build; otherwise `scripts/build-search.js` reports missing site output.
- Renaming or moving docs can break links due to the strict broken-link setting; update references and rerun the build.
- Pagefind output serves from `/pagefind/`; relocating it requires updating the loader component and any deployment config.
- If you adjust freshness thresholds or front-matter keys, update both the scripts and any docs/tutorials referencing them.

For deeper automation details, see `.github/copilot-instructions.md`.
